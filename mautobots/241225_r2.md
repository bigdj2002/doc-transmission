ì•„ë˜ëŠ” **`pyproject.toml`ì„ ë£¨íŠ¸ ê²½ë¡œì— ìœ ì§€í•˜ê³ **, **`lambda` í´ë”ëª…ì„ `src`ë¡œ ë³€ê²½**í•œ êµ¬ì„±ì…ë‹ˆë‹¤. ëª¨ë“  í´ë”ë³„ë¡œ ë‚´ìš©ì„ ì •ë¦¬í•˜ì—¬ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

---

## **ìµœì¢… ë””ë ‰í† ë¦¬ êµ¬ì¡°**

```plaintext
project/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ codepipeline/           # ì½”ë“œíŒŒì´í”„ë¼ì¸ ê´€ë ¨ Terraform
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ outputs.tf
â”‚   â”œâ”€â”€ infrastructure/         # ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê´€ë ¨ Terraform
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ outputs.tf
â”‚   â””â”€â”€ providers.tf            # ê³µí†µ AWS ì œê³µì ì„¤ì •
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.py                  # Lambda í•¨ìˆ˜ ì½”ë“œ
â”‚   â”œâ”€â”€ utils.py                # ìœ í‹¸ë¦¬í‹° íŒŒì¼
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ package_lambda.sh       # Lambda íŒ¨í‚¤ì§• ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ deploy.sh               # CodeBuild ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ buildspec.yml               # í†µí•© ë¹Œë“œ ìŠ¤í™ íŒŒì¼
â”œâ”€â”€ pyproject.toml              # Python ì˜ì¡´ì„± ê´€ë¦¬
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## **1. `src` ë””ë ‰í† ë¦¬ (Lambda ì½”ë“œ)**

### **1.1 `app.py`**
```python
import json

def lambda_handler(event, context):
    """AWS Lambda í•¸ë“¤ëŸ¬ í•¨ìˆ˜"""
    return {
        "statusCode": 200,
        "body": json.dumps({
            "message": "Hello from Lambda!",
            "input": event
        })
    }
```

### **1.2 `utils.py`**
```python
def example_utility_function():
    return "This is a utility function."
```

---

## **2. `pyproject.toml` (ë£¨íŠ¸ ê²½ë¡œì— ìœ ì§€)**

```toml
[build-system]
requires = ["poetry>=1.1.0"]
build-backend = "poetry.core.masonry.api"

[tool.poetry]
name = "my-lambda-app"
version = "0.1.0"
description = "A Python Lambda app using pyproject.toml and Poetry"
authors = ["Your Name <your.email@example.com>"]

[tool.poetry.dependencies]
python = "^3.9"
boto3 = "^1.28.0"
numpy = "^1.25.0"
matplotlib = "^3.7.0"

[tool.poetry.dev-dependencies]
pytest = "^7.0"
```

---

## **3. `terraform` ë””ë ‰í† ë¦¬**

### **3.1 `terraform/codepipeline/main.tf`**
ì½”ë“œíŒŒì´í”„ë¼ì¸ ì •ì˜:
```hcl
resource "aws_codepipeline" "example_pipeline" {
  name     = "example-pipeline"
  role_arn = aws_iam_role.example.arn

  artifact_store {
    type     = "S3"
    location = aws_s3_bucket.example_bucket.bucket
  }

  stage {
    name = "Source"
    action {
      name             = "SourceAction"
      category         = "Source"
      owner            = "AWS"
      provider         = "CodeCommit"
      output_artifacts = ["source_output"]
      configuration = {
        RepositoryName = "my-repo"
        BranchName     = "main"
      }
    }
  }

  stage {
    name = "Build"
    action {
      name             = "BuildAction"
      category         = "Build"
      owner            = "AWS"
      provider         = "CodeBuild"
      input_artifacts  = ["source_output"]
      configuration = {
        ProjectName = "my-codebuild-project"
      }
    }
  }

  stage {
    name = "Deploy"
    action {
      name             = "DeployLambda"
      category         = "Deploy"
      owner            = "AWS"
      provider         = "Lambda"
      input_artifacts  = ["source_output"]
      configuration = {
        FunctionName = "my-lambda-function"
      }
    }
  }
}
```

### **3.2 `terraform/infrastructure/main.tf`**
Lambda ì¸í”„ë¼ ì •ì˜:
```hcl
resource "aws_lambda_function" "example_lambda" {
  function_name    = var.lambda_function_name
  runtime          = "python3.9"
  handler          = "src.app.lambda_handler"
  role             = aws_iam_role.lambda_exec.arn
  s3_bucket        = aws_s3_bucket.example_bucket.id
  s3_key           = "${var.lambda_package_key}"
  memory_size      = 128
  timeout          = 10
}
```

---

## **4. ìŠ¤í¬ë¦½íŠ¸**

### **4.1 Lambda íŒ¨í‚¤ì§• ìŠ¤í¬ë¦½íŠ¸ (`scripts/package_lambda.sh`)**
```bash
#!/bin/bash
set -e

PROJECT_NAME="my-lambda-app"
ZIP_FILE="lambda.zip"

# Install Poetry
echo "Installing Poetry..."
curl -sSL https://install.python-poetry.org | python3 -
export PATH="$HOME/.local/bin:$PATH"

# Install dependencies and package Lambda
echo "Installing dependencies with Poetry..."
poetry config virtualenvs.create false
poetry install --no-dev
zip -r $ZIP_FILE src/ -x "*.git*"

echo "Lambda function packaged as $ZIP_FILE"
```

### **4.2 CodeBuild ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (`scripts/deploy.sh`)**
```bash
#!/bin/bash
set -e

if [ $# -ne 1 ]; then
  echo "Usage: $0 <codepipeline|infrastructure|lambda-code>"
  exit 1
fi

DEPLOY_TARGET=$1
LAMBDA_FUNCTION_NAME="my-lambda-function"
AWS_REGION="ap-northeast-2"

aws codebuild start-build \
  --project-name "my-codebuild-project" \
  --environment-variables-override name=DEPLOY_TARGET,value=$DEPLOY_TARGET,type=PLAINTEXT \
                                   name=LAMBDA_FUNCTION_NAME,value=$LAMBDA_FUNCTION_NAME,type=PLAINTEXT \
                                   name=AWS_REGION,value=$AWS_REGION,type=PLAINTEXT

echo "CodeBuild started with DEPLOY_TARGET=$DEPLOY_TARGET"
```

---

## **5. ë¹Œë“œìŠ¤í™ íŒŒì¼ (`buildspec.yml`)**

```yaml
version: 0.2

phases:
  install:
    commands:
      - echo "Installing required tools..."
      - curl -O https://releases.hashicorp.com/terraform/1.6.0/terraform_1.6.0_linux_amd64.zip
      - unzip terraform_1.6.0_linux_amd64.zip
      - mv terraform /usr/local/bin/
      - echo "Tools installed successfully."

  build:
    commands:
      - echo "Starting deployment process for target: $DEPLOY_TARGET"
      - |
        case "$DEPLOY_TARGET" in
          codepipeline)
            echo "Deploying CodePipeline..."
            cd terraform/codepipeline
            terraform init
            terraform plan -out=tfplan
            terraform apply -auto-approve
            ;;
          infrastructure)
            echo "Deploying Infrastructure..."
            cd terraform/infrastructure
            terraform init
            terraform plan -out=tfplan
            terraform apply -auto-approve
            ;;
          lambda-code)
            echo "Deploying Lambda function code..."
            zip -r lambda.zip src/ -x "*.git*"
            aws lambda update-function-code \
              --function-name "$LAMBDA_FUNCTION_NAME" \
              --zip-file "fileb://lambda.zip" \
              --region "$AWS_REGION"
            aws lambda publish-version \
              --function-name "$LAMBDA_FUNCTION_NAME" \
              --region "$AWS_REGION"
            echo "Lambda code deployment completed."
            ;;
          *)
            echo "Error: Invalid DEPLOY_TARGET value '$DEPLOY_TARGET'"
            exit 1
            ;;
        esac

  post_build:
    commands:
      - echo "Deployment process for $DEPLOY_TARGET completed successfully."
```

---

### **ê²°ë¡ **

- **`pyproject.toml`ì€ ë£¨íŠ¸ ê²½ë¡œì— ìœ ì§€.**
- Lambda ì½”ë“œëŠ” **`src/` ë””ë ‰í† ë¦¬**ì— ìœ„ì¹˜.
- ëª¨ë“  ì‘ì—…(CodePipeline, Infrastructure, Lambda ì½”ë“œ ë””í”Œë¡œì´)ì€ **í™˜ê²½ ë³€ìˆ˜ `DEPLOY_TARGET`**ë¡œ ì œì–´.
- ì „ì²´ êµ¬ì„±ì€ ê¹”ë”í•˜ê²Œ í†µí•©ë˜ì—ˆìœ¼ë©°, ìœ ì§€ë³´ìˆ˜ì™€ í™•ì¥ì´ ìš©ì´. ğŸ¯
